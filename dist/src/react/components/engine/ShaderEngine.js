"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const S=require("react/jsx-runtime"),c=require("react"),_=require("../../../core/managers/WebGLManager.js"),b={},h="",y={},I={},U=({programConfigs:E,renderCallback:T,renderOptions:i=b,className:p=h,style:F=y,uniformUpdaters:L=I,useFastPath:d=!1,useDevicePixelRatio:w=!0})=>{const f=c.useRef(null),o=c.useRef(null),g=c.useRef(null),u=c.useRef(null),R=c.useRef(0),l=c.useRef(n=>{const e=o.current,r=g.current;if(!e||!r)return;const a=n-R.current,t=e.context;if(d)e.fastRender(r,a,i.clear),t.drawArrays(t.TRIANGLE_STRIP,0,4);else{const s=e.resources.get(r);if(!s)return;e.prepareRender(r,i),A(a,s,t)}u.current=requestAnimationFrame(l.current)}),A=c.useCallback((n,e,r)=>{T(n,e,r)},[T]);c.useEffect(()=>{l.current=n=>{const e=o.current,r=g.current;if(!e||!r)return;const a=n-R.current,t=e.context;if(d)e.fastRender(r,a,i.clear),t.drawArrays(t.TRIANGLE_STRIP,0,4);else{const s=e.resources.get(r);if(!s)return;e.prepareRender(r,i),A(a,s,t)}u.current=requestAnimationFrame(l.current)}},[i,d,A]);const m=c.useCallback(()=>{if(!f.current||!o.current)return;const n=window.innerWidth,e=window.innerHeight;o.current.setSize(n,e,w)},[w]);return c.useEffect(()=>{if(f.current)try{const n=new _.WebGLManager(f.current);o.current=n,m();const e=Object.entries(E);if(e.length>0){const[r,a]=e[0];n.createProgram(r,a),n.createBuffer(r,"a_position",new Float32Array([-1,-1,1,-1,-1,1,1,1])),g.current=r,n.setAttributeOnce(r,"a_position",{name:"a_position",size:2,type:"FLOAT",normalized:!1,stride:0,offset:0});const t=L[r];t&&t.forEach(s=>{n.registerUniformUpdater(r,s.name,s.type,s.updateFn)})}return R.current=performance.now(),u.current=requestAnimationFrame(l.current),window.addEventListener("resize",m),()=>{window.removeEventListener("resize",m),u.current&&cancelAnimationFrame(u.current),o.current&&o.current.destroyAll()}}catch(n){return console.error("Failed to initialize WebGL:",n),()=>{}}},[E,L,m]),S.jsx("canvas",{ref:f,className:p,style:F})};exports.ShaderEngine=U;
