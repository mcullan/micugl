"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});class g{constructor(i){this.passes=[],this.pingPongIds=new Set,this.webglManager=i}addPass(i){this.passes.push(i),i.outputFramebuffer&&this.pingPongIds.add(i.outputFramebuffer),i.inputTextures.forEach(r=>{r.bindingType==="readwrite"&&this.pingPongIds.add(r.id)})}clearPasses(){this.passes=[],this.pingPongIds.clear()}execute(i){const r=this.webglManager.context,a=this.webglManager.fbo;for(const e of this.passes){if(e.outputFramebuffer)if(this.pingPongIds.has(e.outputFramebuffer)){const{write:s}=a.getPingPongIndices(e.outputFramebuffer);a.bindFramebuffer(e.outputFramebuffer,s)}else a.bindFramebuffer(e.outputFramebuffer);else a.bindFramebuffer(null);this.webglManager.prepareRender(e.programId,e.renderOptions),e.inputTextures.forEach(s=>{let t=s.bindingType==="read"?0:1;if(this.pingPongIds.has(s.id)){const{read:n,write:o}=a.getPingPongIndices(s.id);t=s.bindingType==="read"||s.bindingType==="readwrite"?n:o}a.bindTexture(s.id,s.textureUnit,t),this.webglManager.setUniform(e.programId,`u_${s.id}`,s.textureUnit,"sampler2D")}),this.webglManager.updateUniforms(e.programId,i),e.uniforms&&Object.entries(e.uniforms).forEach(([s,t])=>{const n=typeof t.value=="function"?t.value(i,r.canvas.width,r.canvas.height):t.value;this.webglManager.setUniform(e.programId,s,n,t.type)}),r.drawArrays(r.TRIANGLE_STRIP,0,4),e.outputFramebuffer&&this.pingPongIds.has(e.outputFramebuffer)&&a.swapTextures(e.outputFramebuffer),e.inputTextures.forEach(s=>{s.bindingType==="readwrite"&&this.pingPongIds.has(s.id)&&a.swapTextures(s.id)})}}initializeResources(){for(const i of this.passes){const r=this.webglManager.resources.get(i.programId);r&&!r.buffers.a_position&&(this.webglManager.createBuffer(i.programId,"a_position",new Float32Array([-1,-1,1,-1,-1,1,1,1])),this.webglManager.setAttributeOnce(i.programId,"a_position",{name:"a_position",size:2,type:"FLOAT",normalized:!1,stride:0,offset:0}))}}}exports.Passes=g;
