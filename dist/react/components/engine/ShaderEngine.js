"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const _=require("react/jsx-runtime"),t=require("react"),F=require("../../../core/managers/WebGLManager.js"),b={},y="",I={},h={},U=({programConfigs:E,renderCallback:T,renderOptions:o=b,className:L=y,style:S=I,uniformUpdaters:p=h,useFastPath:R=!1,useDevicePixelRatio:w=!0})=>{const f=t.useRef(null),a=t.useRef(null),l=t.useRef(null),u=t.useRef(null),g=t.useRef(0),m=t.useRef(r=>{const e=a.current,n=l.current;if(!e||!n)return;const c=r-g.current,s=e.context;if(R)e.fastRender(n,c,o.clear),s.drawArrays(s.TRIANGLE_STRIP,0,4);else{const i=e.resources.get(n);if(!i)return;e.prepareRender(n,o),A(c,i,s)}u.current=requestAnimationFrame(m.current)}),A=t.useCallback((r,e,n)=>{T(r,e,n)},[T]);t.useEffect(()=>{m.current=r=>{const e=a.current,n=l.current;if(!e||!n)return;const c=r-g.current,s=e.context;if(R)e.fastRender(n,c,o.clear),s.drawArrays(s.TRIANGLE_STRIP,0,4);else{const i=e.resources.get(n);if(!i)return;e.prepareRender(n,o),A(c,i,s)}u.current=requestAnimationFrame(m.current)}},[o,R,A]);const d=t.useCallback(()=>{if(!f.current||!a.current)return;const r=window.innerWidth,e=window.innerHeight;a.current.setSize(r,e,w)},[w]);return t.useEffect(()=>{if(!f.current)return;const r=new F.WebGLManager(f.current);a.current=r,d();const[[e,n]]=Object.entries(E);return r.createProgram(e,n),r.createBuffer(e,"a_position",new Float32Array([-1,-1,1,-1,-1,1,1,1])),r.setAttributeOnce(e,"a_position",{name:"a_position",size:2,type:"FLOAT",normalized:!1,stride:0,offset:0}),l.current=e,g.current=performance.now(),u.current=requestAnimationFrame(m.current),window.addEventListener("resize",d),()=>{window.removeEventListener("resize",d),u.current&&cancelAnimationFrame(u.current),r.destroyAll()}},[E,d]),t.useEffect(()=>{const r=a.current,e=l.current;if(!r||!e)return;const n=p[e];n&&n.forEach(c=>{r.registerUniformUpdater(e,c.name,c.type,c.updateFn)})},[p]),_.jsx("canvas",{ref:f,className:L,style:S})};exports.ShaderEngine=U;
