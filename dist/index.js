"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const u=require("./useUniformUpdaters-DGX0mf9g.js"),h=require("./BasePingPongShaderComponent-BvRm7-g5.js"),c=require("./BaseShaderComponent-BSBIvn4B.js");class E{constructor(e){this.effects=new Map,this.chains=new Map,this.defaultFramebufferOptions={width:0,height:0,textureCount:2,textureOptions:{minFilter:WebGLRenderingContext.LINEAR,magFilter:WebGLRenderingContext.LINEAR}},this.webglManager=e}registerEffect(e){this.effects.has(e.id)&&console.warn(`Effect with id ${e.id} already exists, overwriting`),this.webglManager.resources.has(e.programId)||this.webglManager.createProgram(e.programId,e.shaderConfig),this.effects.set(e.id,e)}removeEffect(e){if(!this.effects.has(e)){console.warn(`Effect with id ${e} not found`);return}this.effects.delete(e)}createChain(e,n,t,r=null,a=this.defaultFramebufferOptions){this.chains.has(e)&&console.warn(`Chain with id ${e} already exists, overwriting`);const s=[];for(const o of n){const f=this.effects.get(o);if(!f)throw new Error(`Effect with id ${o} not found`);s.push(f)}const i=[];for(let o=0;o<s.length-1;o++){const f=`${e}-intermediate-${o}`;this.webglManager.fbo.createFramebuffer(f,a),i.push(f)}this.chains.set(e,{id:e,effects:s,inputFramebufferId:t,outputFramebufferId:r,intermediateFramebufferIds:i})}removeChain(e){const n=this.chains.get(e);if(!n){console.warn(`Chain with id ${e} not found`);return}n.intermediateFramebufferIds.forEach(t=>{this.webglManager.fbo.destroy(t)}),this.chains.delete(e)}generatePasses(e,n){const t=this.chains.get(e);if(!t)throw new Error(`Chain with id ${e} not found`);const r=[],a=t.effects.filter(s=>s.enabled);return a.length===0?[{programId:"copy-shader",inputTextures:[{id:t.inputFramebufferId,textureUnit:0,bindingType:"read"}],outputFramebuffer:t.outputFramebufferId,renderOptions:{clear:!0}}]:(a.forEach((s,i)=>{const o=i===0,f=i===a.length-1,m=o?t.inputFramebufferId:t.intermediateFramebufferIds[i-1],b=f?t.outputFramebufferId:t.intermediateFramebufferIds[i],p={};Object.entries(s.uniforms).forEach(([g,l])=>{const w=g.startsWith("u_")?g:`u_${g}`,d=l;p[w]={type:d.type,value:typeof d.value=="function"?(F,M,P)=>{const U=d.value;return U(F,M,P)}:d.value}}),r.push({programId:s.programId,inputTextures:[{id:m,textureUnit:0,bindingType:"read"}],outputFramebuffer:b,uniforms:p,renderOptions:{clear:!0}})}),r)}process(e,n){const t=this.generatePasses(e,n);for(const r of t)r.outputFramebuffer?this.webglManager.fbo.bindFramebuffer(r.outputFramebuffer):this.webglManager.fbo.bindFramebuffer(null),this.webglManager.prepareRender(r.programId,r.renderOptions),r.inputTextures.forEach(a=>{this.webglManager.fbo.bindTexture(a.id,a.textureUnit),this.webglManager.setUniform(r.programId,`u_texture${a.textureUnit}`,a.textureUnit,"sampler2D")}),r.uniforms&&Object.entries(r.uniforms).forEach(([a,s])=>{const i=typeof s.value=="function"?s.value(n,this.webglManager.context.canvas.width,this.webglManager.context.canvas.height):s.value;this.webglManager.setUniform(r.programId,a,i,s.type)}),this.webglManager.context.drawArrays(this.webglManager.context.TRIANGLE_STRIP,0,4)}resizeFramebuffers(e,n){for(const t of this.chains.values())for(const r of t.intermediateFramebufferIds)this.webglManager.fbo.resizeFramebuffer(r,e,n)}destroyAll(){for(const e of this.chains.values())for(const n of e.intermediateFramebufferIds)this.webglManager.fbo.destroy(n);this.chains.clear(),this.effects.clear()}}exports.FBOManager=u.FBOManager;exports.WebGLManager=u.WebGLManager;exports.createCommonUpdaters=u.createCommonUpdaters;exports.createShaderConfig=u.createShaderConfig;exports.createUniformUpdater=u.createUniformUpdater;exports.createUniformUpdaters=u.createUniformUpdaters;exports.useUniformUpdaters=u.useUniformUpdaters;exports.BasePingPongShaderComponent=h.BasePingPongShaderComponent;exports.Passes=h.Passes;exports.PingPongShaderEngine=h.PingPongShaderEngine;exports.usePingPongPasses=h.usePingPongPasses;exports.BaseShaderComponent=c.BaseShaderComponent;exports.ShaderEngine=c.ShaderEngine;exports.useDarkMode=c.useDarkMode;exports.Postprocessing=E;
